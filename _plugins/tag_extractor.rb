require 'set'

module Jekyll
  class TagExtractor < Generator
    safe true
    priority :high

    def generate(site)
      site.posts.docs.each do |post|
        # 如果文章没有手动设置tags，则自动提取
        if post.data['tags'].nil? || post.data['tags'].empty?
          tags = extract_tags(post.data['title'], post.content)
          post.data['tags'] = tags
        end
      end
    end

    private

    def extract_tags(title, content)
      # 中英文关键词提取
      keywords = Set.new
      
      # 从标题中提取关键词
      title_words = extract_keywords_from_text(title)
      keywords.merge(title_words)
      
      # 从内容中提取关键词（取前500字符避免过度处理）
      content_preview = content[0..500] || ""
      content_words = extract_keywords_from_text(content_preview)
      keywords.merge(content_words)
      
      # 返回前5个关键词
      keywords.to_a.first(5)
    end

    def extract_keywords_from_text(text)
      return [] if text.nil? || text.empty?
      
      # 清理HTML标签和markdown语法
      clean_text = text.gsub(/<[^>]*>/, ' ')
                      .gsub(/[*_`#\-\[\](){}]/, ' ')
                      .gsub(/\s+/, ' ')
                      .strip
      
      keywords = Set.new
      
      # 英文关键词提取（2-15个字符的单词）
      english_words = clean_text.scan(/\b[a-zA-Z]{2,15}\b/)
      english_words.each do |word|
        next if stop_words.include?(word.downcase)
        keywords.add(word.downcase) if word.length >= 2
      end
      
      # 中文关键词提取（2-8个字符的词组）
      chinese_words = clean_text.scan(/[\u4e00-\u9fff]{2,8}/)
      chinese_words.each do |word|
        next if chinese_stop_words.include?(word)
        keywords.add(word)
      end
      
      # 技术词汇和专有名词（保持原始大小写）
      tech_words = clean_text.scan(/\b(?:AI|Excel|API|SEO|HTML|CSS|JavaScript|Python|GitHub|OpenAI|ChatGPT|GPT|LLM|ML|NLP|UI|UX|SaaS|B2B|B2C|CSV|JSON|XML|SQL|NoSQL|AWS|Azure|GCP|Docker|Kubernetes|React|Vue|Angular|Node\.js|MongoDB|PostgreSQL|Redis|Elasticsearch|TensorFlow|PyTorch|Jupyter|Pandas|NumPy|Matplotlib|Scikit-learn|Shortcut|Microsoft|Google|Apple|Meta|Tesla|NVIDIA|AMD|Intel|IBM|Oracle|Salesforce|Shopify|Stripe|Zoom|Slack|Notion|Figma|Canva|Photoshop|Illustrator|Premiere|After Effects|Blender|Unity|Unreal|Steam|Epic Games|Valve|Sony|Nintendo|PlayStation|Xbox|Switch|iOS|Android|Windows|macOS|Linux|Ubuntu|CentOS|Debian|Fedora|Chrome|Firefox|Safari|Edge|Opera|Brave|Tor|VPN|SSL|HTTPS|HTTP|TCP|UDP|IP|DNS|CDN|REST|GraphQL|WebSocket|OAuth|JWT|CORS|CSRF|XSS|DDoS|Firewall|Load Balancer|Microservices|Serverless|DevOps|CI\/CD|Jenkins|GitLab|Bitbucket|Jira|Confluence|Trello|Asana|Monday|ClickUp|Basecamp|Discord|Teams|Skype|WhatsApp|Telegram|Signal|WeChat|TikTok|Instagram|Facebook|Twitter|LinkedIn|YouTube|Twitch|Reddit|Pinterest|Snapchat|Clubhouse|Spotify|Apple Music|Amazon Music|Netflix|Hulu|Disney\+|HBO Max|Prime Video|Paramount\+|Peacock|Discovery\+|ESPN\+|Roku|Chromecast|Apple TV|Fire TV|Shield TV|Xiaomi|Huawei|Samsung|LG|Sony|Panasonic|Philips|TCL|Hisense|Vizio|Sharp|Toshiba|JVC|Pioneer|Yamaha|Denon|Marantz|Onkyo|Bose|Sonos|JBL|Harman Kardon|Bang & Olufsen|Sennheiser|Audio-Technica|Shure|AKG|Beyerdynamic|Focal|KEF|Klipsch|Polk Audio|Definitive Technology|SVS|REL|Velodyne|Paradigm|PSB|Revel|Infinity|QSC|Crown|Behringer|Mackie|PreSonus|Focusrite|Scarlett|RME|Universal Audio|Antelope Audio|Apogee|Lynx|Prism Sound|Lavry|Benchmark|Grace Design|Millennia|Neve|SSL|Chandler Limited|Warm Audio|Heritage Audio|BAE|Rupert Neve Designs|Empirical Labs|Eventide|Lexicon|TC Electronic|Waves|Plugin Alliance|FabFilter|iZotope|Native Instruments|Ableton|Logic Pro|Pro Tools|Cubase|Studio One|Reaper|FL Studio|Reason|Bitwig|GarageBand|Audacity|Hindenburg|Adobe Audition|Nuendo|Pyramix|Sequoia|Samplitude|Vegas Pro|DaVinci Resolve|Final Cut Pro|Avid Media Composer|Lightworks|HitFilm|Filmora|Camtasia|ScreenFlow|OBS Studio|Streamlabs|XSplit|Wirecast|vMix|Tricaster|ATEM|Blackmagic|RED|Arri|Canon|Nikon|Fujifilm|Olympus|Leica|Hasselblad|Phase One|Mamiya|Pentax|Ricoh|Sigma|Tamron|Tokina|Zeiss|Voigtlander|Samyang|Rokinon|Laowa|Venus Optics|Irix|Viltrox|Meike|7artisans|TTArtisan|Pergear|Neewer|Godox|Profoto|Broncolor|Elinchrom|Hensel|Bowens|Alien Bees|Einstein|Flashpoint|Westcott|Softlighter|Octabox|Speedlite|Strobe|Continuous|LED|Tungsten|Fluorescent|HMI|Plasma|OLED|QLED|Mini LED|Micro LED|E Ink|LCD|TN|IPS|VA|AMOLED|Super AMOLED|Retina|True Tone|HDR|Dolby Vision|HDR10|HDR10\+|HLG|DCI-P3|Rec\.2020|sRGB|Adobe RGB|ProPhoto RGB|CMYK|Pantone|RAL|NCS|Munsell|CIE|Lab|XYZ|RGB|HSV|HSL|Hex|Bitmap|Vector|Raster|PNG|JPEG|GIF|TIFF|BMP|WebP|AVIF|HEIF|SVG|EPS|PDF|PSD|XD|Sketch|InVision|Principle|Framer|ProtoPie|Marvel|Zeplin|Abstract|Avocode|Sympli|Handoff|Inspect|Measure|Redline|Annotation|Wireframe|Mockup|Prototype|User Flow|User Journey|Persona|Empathy Map|Storyboard|Sitemap|Information Architecture|Card Sorting|Tree Testing|Usability Testing|A\/B Testing|Multivariate Testing|Heatmap|Click Tracking|Eye Tracking|Session Recording|Analytics|Conversion Rate|Bounce Rate|Page Views|Unique Visitors|Sessions|Time on Site|Pages per Session|Exit Rate|Funnel|Cohort|Retention|Churn|LTV|CAC|ARPU|MRR|ARR|NPS|CSAT|CES|Service Design|Design Thinking|Human-Centered Design|Lean UX|Agile UX|Design Sprint|Double Diamond|Jobs to be Done|Outcome-Driven Innovation|Blue Ocean Strategy|Lean Startup|MVP|PMF|Go-to-Market|Product-Market Fit|Traction|Growth Hacking|Viral Coefficient|Network Effect|Platform|Ecosystem|API Economy|Developer Experience|Open Source|Freemium|PaaS|IaaS|FaaS|BaaS|DaaS|XaaS|Cloud|Hybrid Cloud|Multi-Cloud|Edge Computing|Fog Computing|Quantum Computing|Neuromorphic Computing|Optical Computing|DNA Computing|Molecular Computing|Biocomputing|Nanocomputing|Spintronics|Photonics|Plasmonics|Metamaterials|Graphene|Carbon Nanotubes|Quantum Dots|Perovskite|Organic Electronics|Flexible Electronics|Printed Electronics|Wearable Electronics|Implantable Electronics|Biodegradable Electronics|Transparent Electronics|Stretchable Electronics|Self-Healing Electronics|Memristors|Resistive RAM|Phase Change Memory|Ferroelectric RAM|Magnetic RAM|Spin-Transfer Torque RAM|Crossbar Array|Neuromorphic Chip|Spiking Neural Network|Reservoir Computing|Liquid State Machine|Echo State Network|Extreme Learning Machine|Radial Basis Function|Support Vector Machine|Random Forest|Gradient Boosting|XGBoost|LightGBM|CatBoost|AdaBoost|Bagging|Boosting|Ensemble|Stacking|Blending|Cross-Validation|Grid Search|Random Search|Bayesian Optimization|Hyperparameter Tuning|Feature Engineering|Feature Selection|Dimensionality Reduction|Principal Component Analysis|Independent Component Analysis|Linear Discriminant Analysis|t-SNE|UMAP|Manifold Learning|Clustering|K-Means|Hierarchical Clustering|DBSCAN|Mean Shift|Spectral Clustering|Gaussian Mixture Model|Hidden Markov Model|Markov Chain|Monte Carlo|MCMC|Gibbs Sampling|Metropolis-Hastings|Hamiltonian Monte Carlo|Variational Inference|Expectation Maximization|Maximum Likelihood|Maximum A Posteriori|Bayesian Inference|Frequentist|Hypothesis Testing|p-value|Confidence Interval|Statistical Significance|Effect Size|Power Analysis|Multiple Comparisons|Bonferroni Correction|False Discovery Rate|Receiver Operating Characteristic|Area Under Curve|Precision|Recall|F1 Score|Accuracy|Sensitivity|Specificity|Positive Predictive Value|Negative Predictive Value|Matthews Correlation Coefficient|Cohen's Kappa|Cronbach's Alpha|Intraclass Correlation|Pearson Correlation|Spearman Correlation|Kendall's Tau|Mutual Information|Kullback-Leibler Divergence|Jensen-Shannon Divergence|Wasserstein Distance|Earth Mover's Distance|Cosine Similarity|Jaccard Similarity|Dice Coefficient|Hamming Distance|Levenshtein Distance|Edit Distance|Dynamic Time Warping|Longest Common Subsequence|Needleman-Wunsch|Smith-Waterman|BLAST|FASTA|Phylogenetic Tree|Multiple Sequence Alignment|Gene Ontology|Protein Data Bank|UniProt|NCBI|Ensembl|UCSC Genome Browser|GATK|SAMtools|BWA|Bowtie|TopHat|Cufflinks|DESeq2|edgeR|limma|Bioconductor|MATLAB|Octave|Mathematica|Maple|SAS|SPSS|Stata|JMP|Minitab|Origin|GraphPad Prism|Sigma Plot|Tableau|Power BI|Qlik|Looker|Sisense|Domo|Chartio|Metabase|Superset|Grafana|Kibana|Splunk|Elastic Stack|Logstash|Beats|Fluentd|Prometheus|InfluxDB|TimescaleDB|ClickHouse|Apache Kafka|Apache Spark|Apache Flink|Apache Storm|Apache Beam|Apache Airflow|Apache NiFi|Apache Camel|Apache ActiveMQ|Apache RocketMQ|RabbitMQ|Memcached|Hazelcast|Apache Ignite|GridGain|Coherence|Terracotta|EhCache|Caffeine|Guava|Apache Commons|Spring Framework|Spring Boot|Spring Cloud|Spring Security|Spring Data|Hibernate|MyBatis|JPA|JDBC|JNDI|JTA|JMS|JAX-RS|JAX-WS|SOAP|gRPC|Thrift|Avro|Protocol Buffers|MessagePack|BSON|YAML|TOML|INI|Properties|TSV|Parquet|ORC|Arrow|Feather|HDF5|NetCDF|FITS|DICOM|NIfTI|Analyze|MINC|MGH|FreeSurfer|FSL|SPM|AFNI|ANTs|ITK|VTK|SimpleITK|Insight Toolkit|Visualization Toolkit|Open3D|PCL|OpenCV|PIL|Pillow|scikit-image|ImageIO|Seaborn|Plotly|Bokeh|Altair|Pygal|Holoviews|Datashader|Vaex|Dask|Modin|Ray|Celery|Joblib|Multiprocessing|Threading|Asyncio|Tornado|Twisted|Gevent|Eventlet|Gunicorn|uWSGI|mod_wsgi|Waitress|CherryPy|Bottle|Falcon|Sanic|Quart|Starlette|FastAPI|Django|Flask|Pyramid|TurboGears|web2py|Zope|Plone|Mezzanine|Wagtail|Django CMS|Drupal|WordPress|Joomla|Magento|WooCommerce|PrestaShop|OpenCart|osCommerce|Zen Cart|BigCommerce|Squarespace|Wix|Weebly|Webflow|Bubble|Zapier|IFTTT|Microsoft Flow|Azure Logic Apps|AWS Step Functions|Google Cloud Functions|Azure Functions|AWS Lambda|Vercel|Netlify|Heroku|DigitalOcean|Linode|Vultr|Hetzner|OVH|Scaleway|Google Cloud Platform|Amazon Web Services|Microsoft Azure|IBM Cloud|Oracle Cloud|Alibaba Cloud|Tencent Cloud|Baidu Cloud|Huawei Cloud|Naver Cloud|Kakao Cloud|Line Cloud|Rakuten Cloud|SoftBank Cloud|NTT Communications|KDDI|IIJ|Sakura Internet|GMO|Xserver|Lolipop|Heteml|CPanel|Plesk|DirectAdmin|Webmin|Virtualmin|Cloudmin|Proxmox|OpenStack|CloudStack|Eucalyptus|OpenNebula|Apache CloudStack|VMware vSphere|Hyper-V|Citrix XenServer|Oracle VM|QEMU|KVM|Xen|Podman|LXC|LXD|rkt|containerd|CRI-O|OpenShift|Rancher|Nomad|Mesos|Marathon|Chronos|Aurora|ECS|Fargate|Cloud Run|Cloud Functions|App Engine|Compute Engine|Cloud SQL|Cloud Storage|BigQuery|Cloud Pub\/Sub|Cloud Dataflow|Cloud Dataproc|Cloud ML Engine|Cloud Vision API|Cloud Speech API|Cloud Natural Language API|Cloud Translation API|Cloud Video Intelligence API|Cloud AutoML|Cloud AI Platform|Vertex AI|Keras|Caffe|Theano|MXNet|PaddlePaddle|Chainer|DyNet|AllenNLP|Transformers|Hugging Face|spaCy|NLTK|Gensim|Optuna|Hyperopt|Ray Tune|Weights & Biases|MLflow|Kubeflow|TensorBoard|Visdom|Neptune|Comet|Sacred|DVC|Pachyderm|Polyaxon|Flyte|Prefect|Dagster|Luigi|Argo|Tekton|GitLab CI|GitHub Actions|Travis CI|CircleCI|Azure DevOps|TeamCity|Bamboo|Buildkite|Drone|Concourse|Spinnaker|Flux|ArgoCD|Helm|Kustomize|Skaffold|Tilt|Garden|Okteto|DevSpace|Telepresence|Istio|Linkerd|Consul Connect|Envoy|Traefik|NGINX|Apache HTTP Server|Caddy|HAProxy|Cloudflare|Fastly|KeyCDN|MaxCDN|CloudFront|Azure CDN|Google Cloud CDN|Akamai|Incapsula|Sucuri|DDoS Protection|Web Application Firewall|SSL Certificate|Let's Encrypt|DigiCert|Comodo|Symantec|GeoTrust|Thawte|RapidSSL|Wildcard SSL|Extended Validation|Domain Validation|Organization Validation|Certificate Authority|Public Key Infrastructure|X\.509|PKCS|ASN\.1|DER|PEM|PKCS#12|Java KeyStore|JCEKS|BKS|UBER|BCFKS|OpenSSL|LibreSSL|BoringSSL|WolfSSL|mbedTLS|GnuTLS|NSS|SChannel|Secure Transport|CommonCrypto|Crypto\+\+|Botan|NaCl|libsodium|OpenSSH|PuTTY|WinSCP|FileZilla|Cyberduck|Transmit|ForkLift|Commander One|Path Finder|Finder|Windows Explorer|File Explorer|Nautilus|Dolphin|Thunar|PCManFM|Ranger|Midnight Commander|Total Commander|Directory Opus|XYplorer|Q-Dir|Multi Commander|FreeCommander|Double Commander|Krusader|Konqueror|Amarok|Rhythmbox|Banshee|Clementine|Strawberry|Foobar2000|Winamp|VLC|MPC-HC|PotPlayer|KMPlayer|GOM Player|SMPlayer|MPV|Kodi|Plex|Emby|Jellyfin|Universal Media Server|Serviio|Twonky|Bubble UPnP|BubbleUPnP|AllConnect|LocalCast|Web Video Caster|AirPlay|Miracast|DLNA|UPnP|Bonjour|Zeroconf|mDNS|DNS-SD|Avahi|Netatalk|Samba|NFS|CIFS|SMB|FTP|SFTP|SCP|rsync|rclone|Duplicati|Duplicity|Borg|Restic|Bacula|Amanda|Bareos|Veeam|Acronis|Macrium Reflect|EaseUS Todo|AOMEI Backupper|Paragon|Clonezilla|dd|Ghost|Norton Ghost|Drive Image|True Image|Carbon Copy Cloner|SuperDuper|ChronoSync|Arq|Backblaze|Carbonite|CrashPlan|IDrive|SpiderOak|Tresorit|pCloud|Sync|Mega|Dropbox|Google Drive|OneDrive|iCloud|Amazon Drive|Box|Nextcloud|ownCloud|Seafile|Syncthing|BitTorrent Sync|Resilio Sync|FreeFileSync|Unison|GoodSync|Beyond Compare|WinMerge|KDiff3|Meld|DiffMerge|Araxis Merge|ExamDiff|Compare It|Text Compare|File Compare|Folder Compare|Directory Compare|Binary Compare|Hex Compare|Image Compare|PDF Compare|Word Compare|Excel Compare|PowerPoint Compare|Notepad\+\+|Sublime Text|Visual Studio Code|Atom|Brackets|Vim|Emacs|Nano|Gedit|Kate|KWrite|Pluma|Leafpad|Mousepad|TextEdit|Notepad|WordPad|Write|AbiWord|LibreOffice Writer|OpenOffice Writer|WPS Writer|Polaris Office|OnlyOffice|Google Docs|Microsoft Word|Apple Pages|Scrivener|Ulysses|Bear|Obsidian|Roam Research|Logseq|Foam|Dendron|Zettlr|Typora|Mark Text|Ghostwriter|ReText|Zim|CherryTree|Joplin|Standard Notes|Simplenote|Evernote|OneNote|Google Keep|Apple Notes|Zoho Notebook|Nimbus Note|Turtl|Laverna|QOwnNotes|Trilium|TiddlyWiki|DokuWiki|MediaWiki|Bookstack|Outline|Slab|Guru|Document360|GitBook|Gitiles|MkDocs|Sphinx|Jekyll|Hugo|Gatsby|Next\.js|Nuxt\.js|Gridsome|Sapper|SvelteKit|Astro|Eleventy|Hexo|Pelican|Lektor|Nikola|Zola|Cobalt|mdBook|VuePress|Docsify|Docusaurus|Storybook|Styleguidist|React Styleguidist|Vue Styleguidist|Bit|Lerna|Nx|Rush|Yarn Workspaces|npm Workspaces|pnpm|Yarn|npm|Bower|jspm|SystemJS|RequireJS|AMD|CommonJS|ES6 Modules|UMD|IIFE|Webpack|Rollup|Parcel|Vite|Snowpack|esbuild|SWC|Babel|TypeScript|Flow|PropTypes|ESLint|Prettier|JSHint|JSLint|StandardJS|Airbnb|jQuery|Lodash|Underscore|Ramda|RxJS|Immutable|Moment|Day\.js|date-fns|Luxon|D3|Chart\.js|Highcharts|ECharts|Plotly\.js|Three\.js|Babylon\.js|A-Frame|WebGL|WebXR|WebAssembly|Emscripten|AssemblyScript|Rust|Go|C\+\+|C#|Java|Kotlin|Scala|Clojure|F#|Haskell|Erlang|Elixir|Phoenix|Ruby|Rails|Sinatra|Hanami|Tornado|Bottle|PHP|Laravel|Symfony|CodeIgniter|Zend|CakePHP|Phalcon|Slim|Lumen|Yii|Deno|Bun|Express|Koa|Fastify|Hapi|Restify|Meteor|Feathers|Nest\.js|Adonis|Strapi|Keystone|Prisma|Hasura|Apollo|Relay|Urql|SWR|React Query|Zustand|Redux|MobX|Recoil|Jotai|Valtio|XState|Immer|Svelte|Solid|Lit|Stencil|Preact|Inferno|Hyperapp|Mithril|Riot|Polymer|Ember|Backbone|Knockout|Aurelia|Marko|Glimmer|Alpine\.js|Stimulus|Turbo|Hotwire|HTMX|Unpoly|Intercooler|Pjax|Turbolinks|InstantClick|Barba\.js|Swup|Highway|Transition\.js|GSAP|Framer Motion|React Spring|React Transition Group|Lottie|Rive|Spine|DragonBones|Pixi\.js|Phaser|WebGPU|PWA|Service Worker|Web Workers|Shared Array Buffer|Atomics|WebRTC|Server-Sent Events|Fetch|XMLHttpRequest|Axios|Superagent|Got|Undici|Cross-fetch|Isomorphic-fetch|Whatwg-fetch|Node-fetch|Request|Supertest|Nock|Mock Service Worker|Mirage|JSON Server|Postman|Insomnia|HTTPie|curl|wget|Paw|RapidAPI|Swagger|OpenAPI|Thunder Client|REST Client|Advanced REST Client|Talend API Tester|SoapUI|Katalon|Selenium|WebDriver|Puppeteer|Playwright|Cypress|TestCafe|Nightwatch|Protractor|WebDriverIO|Appium|Detox|Espresso|XCTest|JUnit|TestNG|Mockito|PowerMock|EasyMock|WireMock|Testcontainers|Docker Compose|Vagrant|VirtualBox|VMware|Parallels|WSL|WSL2|RHEL|openSUSE|SLES|Alpine|Arch|Gentoo|Slackware|FreeBSD|OpenBSD|NetBSD|Chrome OS|Fire OS|Tizen|KaiOS|HarmonyOS|Fuchsia|QNX|VxWorks|FreeRTOS|Zephyr|Mbed|Arduino|Raspberry Pi|ESP32|ESP8266|STM32|AVR|PIC|ARM|x86|x64|RISC-V|MIPS|PowerPC|SPARC|Itanium|Alpha|PA-RISC|S\/390|z\/Architecture|POWER|OpenPOWER|Qualcomm|MediaTek|Broadcom|Marvell|Texas Instruments|Analog Devices|Maxim|Linear Technology|Infineon|STMicroelectronics|NXP|Renesas|Microchip|Cypress|Lattice|Xilinx|Altera|Microsemi|Actel|QuickLogic|SiTime|Maxim Integrated)\b/i)
      tech_words.each do |word|
        keywords.add(word)
      end
      
      keywords.to_a
    end

    def stop_words
      %w[the a an and or but in on at to for of with by from up about into over after]
    end

    def chinese_stop_words
      %w[的 了 是 在 有 和 就 不 人 都 一 一个 上 也 很 到 说 要 去 你 会 着 没有 看 好 自己 这样]
    end
  end
end 